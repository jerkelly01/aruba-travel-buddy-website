(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,45364,e=>{"use strict";let t="http://localhost:5001/api";async function s(e,r={}){let a=localStorage.getItem("authToken");if(!a||"mock-token-for-demo"===a)return{success:!1,error:"Authentication required. Please log in.",details:{type:"AuthError",message:"No valid authentication token found. Please log in to access admin features."}};let n={"Content-Type":"application/json",...r.headers};a&&(n.Authorization=`Bearer ${a}`);try{let s,a=await fetch(`${t}${e}`,{...r,headers:n}),i=await a.text(),o=a.headers.get("content-type")||"",l=o.includes("application/json"),c=i.trim(),d=c.startsWith("<!DOCTYPE")||c.startsWith("<html")||c.startsWith("<!")||c.toLowerCase().startsWith("<body"),m=0===c.length;if(!d&&!m&&(c.startsWith("{")||c.startsWith("[")||c.startsWith('"'))&&!l&&!d&&!m){console.warn("Response looks like JSON but Content-Type is not set correctly. Attempting to parse...");try{let e=JSON.parse(i);if(!a.ok)return{success:!1,error:e.error||`Request failed: ${a.status} ${a.statusText}`,details:e.details};return e}catch(e){console.warn("Failed to parse as JSON despite looking like JSON:",e)}}if(!l||d||m){let s,n=a.status,c=a.statusText,g=`${t}${e}`,u=r.method||"GET",p=i.length,h=i.substring(0,500),x={};try{x=Object.fromEntries(a.headers.entries())}catch(e){x={error:"Could not read headers"}}console.error("=== Non-JSON Response Error ==="),console.error("Status:",n),console.error("Status Text:",c),console.error("Content-Type:",o||"(not set)"),console.error("URL:",g),console.error("Method:",u),console.error("Response Length:",p),console.error("Is Empty:",m),console.error("Looks Like HTML:",d),console.error("Is JSON:",l),console.error("Response Preview:",h),console.error("All Headers:",JSON.stringify(x,null,2)),console.error("Full Response Text:",i),console.error("=============================");let y={status:n,statusText:c,contentType:o||"(not set)",url:g,method:u,textLength:p,isEmpty:m,looksLikeHtml:d,isJson:l,preview:h,allHeaders:x};return s=m?`Backend server returned empty response (${n} ${c}). The endpoint may not be implemented or there's a server error. Check backend logs.`:d?`Backend server returned HTML instead of JSON (${n} ${c}). This usually means the backend server is not running or the endpoint doesn't exist. Make sure the backend server is running at ${t}`:`Backend server returned non-JSON response (${n} ${c}). Content-Type: ${o||"(not set)"}. Response preview: ${h.substring(0,100)}...`,{success:!1,error:s,details:y}}try{s=JSON.parse(i)}catch(s){return console.error("JSON parse error:",{error:s,status:a.status,statusText:a.statusText,contentType:o,url:`${t}${e}`,preview:i.substring(0,200)}),{success:!1,error:`Backend server returned invalid JSON. Make sure the backend server is running at ${t}`,details:{status:a.status,contentType:o,preview:i.substring(0,200),parseError:s instanceof Error?s.message:String(s)}}}if(!a.ok){if(401===a.status||403===a.status)return localStorage.removeItem("authToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),{success:!1,error:s.error||"Authentication failed. Please log in again.",details:{...s.details,type:"AuthError",status:a.status,requiresLogin:!0}};return{success:!1,error:s.error||`Request failed: ${a.status} ${a.statusText}`,details:s.details}}return s}catch(s){if(console.error("=== API Request Failed (Catch Block) ==="),console.error("Error Type:",s instanceof Error?s.constructor.name:typeof s),console.error("Error Message:",s instanceof Error?s.message:String(s)),console.error("Error Stack:",s instanceof Error?s.stack:"N/A"),console.error("Endpoint:",`${t}${e}`),console.error("Options:",JSON.stringify(r,null,2)),console.error("========================================"),s instanceof TypeError&&(s.message.includes("fetch")||s.message.includes("Failed to fetch")))return{success:!1,error:`Cannot connect to backend server at ${t}. Make sure the backend server is running and accessible.`,details:{originalError:s.message,endpoint:`${t}${e}`,type:"NetworkError"}};if(s instanceof SyntaxError&&s.message.includes("JSON"))return{success:!1,error:`Backend server is not responding correctly. Make sure the backend server is running at ${t}`,details:{originalError:s.message,endpoint:`${t}${e}`,type:"ParseError"}};return{success:!1,error:s instanceof Error?s.message:"Unknown network error",details:{originalError:String(s),endpoint:`${t}${e}`,type:"UnknownError"}}}}function r(e){return{getAll:async t=>{let r=new URLSearchParams;t?.page&&r.append("page",t.page.toString()),t?.limit&&r.append("limit",t.limit.toString()),t?.category&&r.append("category",t.category),t?.featured&&r.append("featured","true"),t?.active!==void 0&&r.append("active",t.active.toString()),t?.search&&r.append("search",t.search);let a=r.toString();return s(`/admin/${e}${a?`?${a}`:""}`)},getById:async t=>s(`/admin/${e}/${t}`),create:async t=>s(`/admin/${e}`,{method:"POST",body:JSON.stringify(t)}),update:async(t,r)=>s(`/admin/${e}/${t}`,{method:"PUT",body:JSON.stringify(r)}),delete:async t=>s(`/admin/${e}/${t}`,{method:"DELETE"})}}let a=r("tours"),n=r("cultural-events"),i=r("local-experiences"),o=r("transportation"),l=r("support-locals"),c=r("restaurants"),d=r("photo-challenges");e.s(["clientProfileApi",0,{getClients:async e=>{let t=new URLSearchParams;e?.page&&t.append("page",e.page.toString()),e?.limit&&t.append("limit",e.limit.toString()),e?.status&&t.append("status",e.status),e?.category&&t.append("category",e.category),e?.featured&&t.append("featured","true"),e?.search&&t.append("search",e.search);let r=t.toString();return s(`/admin/clients${r?`?${r}`:""}`)},getClient:async e=>s(`/admin/clients/${e}`),createClient:async e=>s("/admin/clients",{method:"POST",body:JSON.stringify(e)}),updateClient:async(e,t)=>s(`/admin/clients/${e}`,{method:"PUT",body:JSON.stringify(t)}),deleteClient:async e=>s(`/admin/clients/${e}`,{method:"DELETE"}),getVersions:async e=>s(`/admin/clients/${e}/versions`)},"culturalEventsApi",0,n,"localExperiencesApi",0,i,"mapLocationsApi",0,{getAll:async e=>{let t=new URLSearchParams;e?.page&&t.append("page",e.page.toString()),e?.limit&&t.append("limit",e.limit.toString()),e?.category&&t.append("category",e.category),e?.featured&&t.append("featured","true"),e?.active!==void 0&&t.append("active",e.active.toString()),e?.search&&t.append("search",e.search);let r=t.toString();return s(`/admin/map-locations${r?`?${r}`:""}`)},getById:async e=>s(`/admin/map-locations/${e}`),create:async e=>s("/admin/map-locations",{method:"POST",body:JSON.stringify(e)}),update:async(e,t)=>s(`/admin/map-locations/${e}`,{method:"PUT",body:JSON.stringify(t)}),delete:async e=>s(`/admin/map-locations/${e}`,{method:"DELETE"})},"photoChallengesApi",0,d,"restaurantsApi",0,c,"supportLocalsApi",0,l,"toursApi",0,a,"transportationApi",0,o,"websiteAnalyticsApi",0,{getOverview:async e=>{let t=e?`?timeRange=${e}`:"";return s(`/admin/analytics/website/overview${t}`)},getTrafficMetrics:async e=>{let t=new URLSearchParams;e?.timeRange&&t.append("timeRange",e.timeRange),e?.groupBy&&t.append("groupBy",e.groupBy);let r=t.toString();return s(`/admin/analytics/website/traffic${r?`?${r}`:""}`)},getPopularPages:async e=>{let t=new URLSearchParams;e?.timeRange&&t.append("timeRange",e.timeRange),e?.limit&&t.append("limit",e.limit.toString());let r=t.toString();return s(`/admin/analytics/website/pages${r?`?${r}`:""}`)},getVisitorAnalytics:async e=>{let t=e?`?timeRange=${e}`:"";return s(`/admin/analytics/website/visitors${t}`)},getConversionFunnels:async e=>{let t=new URLSearchParams;e?.timeRange&&t.append("timeRange",e.timeRange),e?.conversionGoal&&t.append("conversionGoal",e.conversionGoal);let r=t.toString();return s(`/admin/analytics/website/conversions${r?`?${r}`:""}`)},exportAnalytics:async e=>{let t=new URLSearchParams;e?.format&&t.append("format",e.format),e?.timeRange&&t.append("timeRange",e.timeRange);let r=t.toString();return s(`/admin/analytics/website/export${r?`?${r}`:""}`)},trackEvent:async e=>s("/admin/analytics/website/track",{method:"POST",body:JSON.stringify(e)})}])},54322,e=>{"use strict";var t=e.i(24638),s=e.i(49659),r=e.i(3301),a=e.i(43447),n=e.i(52961),i=e.i(45364);function o(){let e=(0,r.useRouter)(),{user:o,isLoading:l,isAuthenticated:c}=(0,a.useAuth)(),[d,m]=(0,s.useState)("30d"),[g,u]=(0,s.useState)(null),[p,h]=(0,s.useState)(!0);(0,s.useEffect)(()=>{l||c||e.push("/login")},[l,c,e]),(0,s.useEffect)(()=>{c&&x()},[c,d]);let x=async()=>{h(!0);try{let e=await i.websiteAnalyticsApi.getOverview(d);e.success&&e.data&&u(e.data)}catch(e){console.error("Failed to fetch analytics:",e)}finally{h(!1)}};return l?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsx)("div",{className:"text-gray-600",children:"Loading..."})}):c?(0,t.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,t.jsx)("div",{className:"bg-white shadow",children:(0,t.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Website Analytics"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Track website performance and visitor behavior"})]}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)(n.default,{href:"/admin",className:"px-4 py-2 text-gray-700 hover:text-gray-900",children:"Dashboard"}),(0,t.jsxs)("select",{value:d,onChange:e=>m(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[var(--brand-aruba)]",children:[(0,t.jsx)("option",{value:"7d",children:"Last 7 days"}),(0,t.jsx)("option",{value:"30d",children:"Last 30 days"}),(0,t.jsx)("option",{value:"90d",children:"Last 90 days"})]})]})]})})}),(0,t.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:p?(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)("div",{className:"text-gray-600",children:"Loading analytics..."})}):g?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,t.jsx)("div",{className:"text-gray-600 text-sm font-medium",children:"Total Visitors"}),(0,t.jsx)("div",{className:"text-3xl font-bold text-gray-900 mt-2",children:g.totalVisitors?.toLocaleString()||0}),(0,t.jsxs)("div",{className:"text-green-600 text-sm mt-2",children:[d," period"]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,t.jsx)("div",{className:"text-gray-600 text-sm font-medium",children:"Page Views"}),(0,t.jsx)("div",{className:"text-3xl font-bold text-gray-900 mt-2",children:g.totalPageViews?.toLocaleString()||0}),(0,t.jsxs)("div",{className:"text-gray-600 text-sm mt-2",children:[g.totalVisitors>0?Math.round(g.totalPageViews/g.totalVisitors):0," ","pages per visitor"]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,t.jsx)("div",{className:"text-gray-600 text-sm font-medium",children:"Bounce Rate"}),(0,t.jsxs)("div",{className:"text-3xl font-bold text-gray-900 mt-2",children:[g.bounceRate?.toFixed(1)||0,"%"]}),(0,t.jsx)("div",{className:"text-gray-600 text-sm mt-2",children:g.bounceRate<40?"Excellent":g.bounceRate<60?"Good":"Needs improvement"})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,t.jsx)("div",{className:"text-gray-600 text-sm font-medium",children:"Avg Session Duration"}),(0,t.jsxs)("div",{className:"text-3xl font-bold text-gray-900 mt-2",children:[g.avgSessionDuration?Math.round(g.avgSessionDuration/60):0,"m"]}),(0,t.jsx)("div",{className:"text-gray-600 text-sm mt-2",children:g.avgSessionDuration?`${g.avgSessionDuration%60}s`:"0s"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"New Visitors"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-[var(--brand-aruba)]",children:g.newVisitors?.toLocaleString()||0}),(0,t.jsxs)("div",{className:"text-sm text-gray-600 mt-2",children:[g.totalVisitors>0?Math.round(g.newVisitors/g.totalVisitors*100):0,"% of total visitors"]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Returning Visitors"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-[var(--brand-amber)]",children:(g.totalVisitors-g.newVisitors)?.toLocaleString()||0}),(0,t.jsxs)("div",{className:"text-sm text-gray-600 mt-2",children:[g.totalVisitors>0?Math.round((g.totalVisitors-g.newVisitors)/g.totalVisitors*100):0,"% of total visitors"]})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Traffic Over Time"}),(0,t.jsx)("p",{className:"text-gray-600 text-sm",children:"Charts will be implemented with Chart.js or Recharts library"}),(0,t.jsx)("div",{className:"mt-4 h-64 bg-gray-100 rounded flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-gray-500",children:"Chart visualization coming soon"})})]})]}):(0,t.jsx)("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:(0,t.jsx)("p",{className:"text-gray-600",children:"No analytics data available"})})})]}):null}e.s(["default",()=>o])}]);