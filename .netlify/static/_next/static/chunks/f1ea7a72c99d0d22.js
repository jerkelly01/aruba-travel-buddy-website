(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,45364,e=>{"use strict";let t="http://localhost:5001/api";async function r(e,a={}){let s=localStorage.getItem("authToken");if(!s||"mock-token-for-demo"===s)return{success:!1,error:"Authentication required. Please log in.",details:{type:"AuthError",message:"No valid authentication token found. Please log in to access admin features."}};let n={"Content-Type":"application/json",...a.headers};s&&(n.Authorization=`Bearer ${s}`);try{let r,s=await fetch(`${t}${e}`,{...a,headers:n}),i=await s.text(),l=s.headers.get("content-type")||"",o=l.includes("application/json"),c=i.trim(),d=c.startsWith("<!DOCTYPE")||c.startsWith("<html")||c.startsWith("<!")||c.toLowerCase().startsWith("<body"),u=0===c.length;if(!d&&!u&&(c.startsWith("{")||c.startsWith("[")||c.startsWith('"'))&&!o&&!d&&!u){console.warn("Response looks like JSON but Content-Type is not set correctly. Attempting to parse...");try{let e=JSON.parse(i);if(!s.ok)return{success:!1,error:e.error||`Request failed: ${s.status} ${s.statusText}`,details:e.details};return e}catch(e){console.warn("Failed to parse as JSON despite looking like JSON:",e)}}if(!o||d||u){let r,n=s.status,c=s.statusText,g=`${t}${e}`,p=a.method||"GET",m=i.length,h=i.substring(0,500),x={};try{x=Object.fromEntries(s.headers.entries())}catch(e){x={error:"Could not read headers"}}console.error("=== Non-JSON Response Error ==="),console.error("Status:",n),console.error("Status Text:",c),console.error("Content-Type:",l||"(not set)"),console.error("URL:",g),console.error("Method:",p),console.error("Response Length:",m),console.error("Is Empty:",u),console.error("Looks Like HTML:",d),console.error("Is JSON:",o),console.error("Response Preview:",h),console.error("All Headers:",JSON.stringify(x,null,2)),console.error("Full Response Text:",i),console.error("=============================");let y={status:n,statusText:c,contentType:l||"(not set)",url:g,method:p,textLength:m,isEmpty:u,looksLikeHtml:d,isJson:o,preview:h,allHeaders:x};return r=u?`Backend server returned empty response (${n} ${c}). The endpoint may not be implemented or there's a server error. Check backend logs.`:d?`Backend server returned HTML instead of JSON (${n} ${c}). This usually means the backend server is not running or the endpoint doesn't exist. Make sure the backend server is running at ${t}`:`Backend server returned non-JSON response (${n} ${c}). Content-Type: ${l||"(not set)"}. Response preview: ${h.substring(0,100)}...`,{success:!1,error:r,details:y}}try{r=JSON.parse(i)}catch(r){return console.error("JSON parse error:",{error:r,status:s.status,statusText:s.statusText,contentType:l,url:`${t}${e}`,preview:i.substring(0,200)}),{success:!1,error:`Backend server returned invalid JSON. Make sure the backend server is running at ${t}`,details:{status:s.status,contentType:l,preview:i.substring(0,200),parseError:r instanceof Error?r.message:String(r)}}}if(!s.ok){if(401===s.status||403===s.status)return localStorage.removeItem("authToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),{success:!1,error:r.error||"Authentication failed. Please log in again.",details:{...r.details,type:"AuthError",status:s.status,requiresLogin:!0}};return{success:!1,error:r.error||`Request failed: ${s.status} ${s.statusText}`,details:r.details}}return r}catch(r){if(console.error("=== API Request Failed (Catch Block) ==="),console.error("Error Type:",r instanceof Error?r.constructor.name:typeof r),console.error("Error Message:",r instanceof Error?r.message:String(r)),console.error("Error Stack:",r instanceof Error?r.stack:"N/A"),console.error("Endpoint:",`${t}${e}`),console.error("Options:",JSON.stringify(a,null,2)),console.error("========================================"),r instanceof TypeError&&(r.message.includes("fetch")||r.message.includes("Failed to fetch")))return{success:!1,error:`Cannot connect to backend server at ${t}. Make sure the backend server is running and accessible.`,details:{originalError:r.message,endpoint:`${t}${e}`,type:"NetworkError"}};if(r instanceof SyntaxError&&r.message.includes("JSON"))return{success:!1,error:`Backend server is not responding correctly. Make sure the backend server is running at ${t}`,details:{originalError:r.message,endpoint:`${t}${e}`,type:"ParseError"}};return{success:!1,error:r instanceof Error?r.message:"Unknown network error",details:{originalError:String(r),endpoint:`${t}${e}`,type:"UnknownError"}}}}function a(e){return{getAll:async t=>{let a=new URLSearchParams;t?.page&&a.append("page",t.page.toString()),t?.limit&&a.append("limit",t.limit.toString()),t?.category&&a.append("category",t.category),t?.featured&&a.append("featured","true"),t?.active!==void 0&&a.append("active",t.active.toString()),t?.search&&a.append("search",t.search);let s=a.toString();return r(`/admin/${e}${s?`?${s}`:""}`)},getById:async t=>r(`/admin/${e}/${t}`),create:async t=>r(`/admin/${e}`,{method:"POST",body:JSON.stringify(t)}),update:async(t,a)=>r(`/admin/${e}/${t}`,{method:"PUT",body:JSON.stringify(a)}),delete:async t=>r(`/admin/${e}/${t}`,{method:"DELETE"})}}let s=a("tours"),n=a("cultural-events"),i=a("local-experiences"),l=a("transportation"),o=a("support-locals"),c=a("restaurants"),d=a("photo-challenges");e.s(["clientProfileApi",0,{getClients:async e=>{let t=new URLSearchParams;e?.page&&t.append("page",e.page.toString()),e?.limit&&t.append("limit",e.limit.toString()),e?.status&&t.append("status",e.status),e?.category&&t.append("category",e.category),e?.featured&&t.append("featured","true"),e?.search&&t.append("search",e.search);let a=t.toString();return r(`/admin/clients${a?`?${a}`:""}`)},getClient:async e=>r(`/admin/clients/${e}`),createClient:async e=>r("/admin/clients",{method:"POST",body:JSON.stringify(e)}),updateClient:async(e,t)=>r(`/admin/clients/${e}`,{method:"PUT",body:JSON.stringify(t)}),deleteClient:async e=>r(`/admin/clients/${e}`,{method:"DELETE"}),getVersions:async e=>r(`/admin/clients/${e}/versions`)},"culturalEventsApi",0,n,"localExperiencesApi",0,i,"mapLocationsApi",0,{getAll:async e=>{let t=new URLSearchParams;e?.page&&t.append("page",e.page.toString()),e?.limit&&t.append("limit",e.limit.toString()),e?.category&&t.append("category",e.category),e?.featured&&t.append("featured","true"),e?.active!==void 0&&t.append("active",e.active.toString()),e?.search&&t.append("search",e.search);let a=t.toString();return r(`/admin/map-locations${a?`?${a}`:""}`)},getById:async e=>r(`/admin/map-locations/${e}`),create:async e=>r("/admin/map-locations",{method:"POST",body:JSON.stringify(e)}),update:async(e,t)=>r(`/admin/map-locations/${e}`,{method:"PUT",body:JSON.stringify(t)}),delete:async e=>r(`/admin/map-locations/${e}`,{method:"DELETE"})},"photoChallengesApi",0,d,"restaurantsApi",0,c,"supportLocalsApi",0,o,"toursApi",0,s,"transportationApi",0,l,"websiteAnalyticsApi",0,{getOverview:async e=>{let t=e?`?timeRange=${e}`:"";return r(`/admin/analytics/website/overview${t}`)},getTrafficMetrics:async e=>{let t=new URLSearchParams;e?.timeRange&&t.append("timeRange",e.timeRange),e?.groupBy&&t.append("groupBy",e.groupBy);let a=t.toString();return r(`/admin/analytics/website/traffic${a?`?${a}`:""}`)},getPopularPages:async e=>{let t=new URLSearchParams;e?.timeRange&&t.append("timeRange",e.timeRange),e?.limit&&t.append("limit",e.limit.toString());let a=t.toString();return r(`/admin/analytics/website/pages${a?`?${a}`:""}`)},getVisitorAnalytics:async e=>{let t=e?`?timeRange=${e}`:"";return r(`/admin/analytics/website/visitors${t}`)},getConversionFunnels:async e=>{let t=new URLSearchParams;e?.timeRange&&t.append("timeRange",e.timeRange),e?.conversionGoal&&t.append("conversionGoal",e.conversionGoal);let a=t.toString();return r(`/admin/analytics/website/conversions${a?`?${a}`:""}`)},exportAnalytics:async e=>{let t=new URLSearchParams;e?.format&&t.append("format",e.format),e?.timeRange&&t.append("timeRange",e.timeRange);let a=t.toString();return r(`/admin/analytics/website/export${a?`?${a}`:""}`)},trackEvent:async e=>r("/admin/analytics/website/track",{method:"POST",body:JSON.stringify(e)})}])},63465,e=>{"use strict";var t=e.i(24638),r=e.i(49659),a=e.i(3301),s=e.i(43447),n=e.i(52961),i=e.i(45364);function l(){let e=(0,a.useRouter)(),{user:l,isLoading:c,isAuthenticated:d}=(0,s.useAuth)(),[u,g]=(0,r.useState)([]),[p,m]=(0,r.useState)(!0),[h,x]=(0,r.useState)(null),[y,b]=(0,r.useState)(!1),[v,f]=(0,r.useState)(!1),[j,N]=(0,r.useState)({status:"",category:"",search:""});(0,r.useEffect)(()=>{c||d||e.push("/login")},[c,d,e]),(0,r.useEffect)(()=>{d&&S()},[d,j]);let S=async()=>{m(!0);try{let e=await i.clientProfileApi.getClients({...j,featured:"featured"===j.status||void 0});if(e.success&&e.data){let t=Array.isArray(e.data)?e.data:e.data?.clients||[];g(t)}}catch(e){console.error("Failed to fetch clients:",e)}finally{m(!1)}},w=()=>{x(null),f(!0),b(!0)},$=async e=>{if(confirm("Are you sure you want to delete this client?"))try{let t=await i.clientProfileApi.deleteClient(e);t.success?S():alert(t.error||"Failed to delete client")}catch(e){console.error("Failed to delete client:",e),alert("Failed to delete client")}};return c?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsx)("div",{className:"text-gray-600",children:"Loading..."})}):d?(0,t.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,t.jsx)("div",{className:"bg-white shadow",children:(0,t.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Client Management"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Manage client profiles"})]}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)(n.default,{href:"/admin",className:"px-4 py-2 text-gray-700 hover:text-gray-900",children:"Dashboard"}),(0,t.jsx)("button",{onClick:w,className:"bg-[var(--brand-aruba)] text-white px-4 py-2 rounded-lg hover:bg-[var(--brand-aruba-dark)] transition-colors",children:"+ Add Client"})]})]})})}),(0,t.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,t.jsx)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search"}),(0,t.jsx)("input",{type:"text",value:j.search,onChange:e=>N({...j,search:e.target.value}),placeholder:"Search clients...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[var(--brand-aruba)]"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,t.jsxs)("select",{value:j.status,onChange:e=>N({...j,status:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[var(--brand-aruba)]",children:[(0,t.jsx)("option",{value:"",children:"All Statuses"}),(0,t.jsx)("option",{value:"active",children:"Active"}),(0,t.jsx)("option",{value:"inactive",children:"Inactive"}),(0,t.jsx)("option",{value:"pending",children:"Pending"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),(0,t.jsx)("input",{type:"text",value:j.category,onChange:e=>N({...j,category:e.target.value}),placeholder:"Filter by category...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[var(--brand-aruba)]"})]})]})}),p?(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)("div",{className:"text-gray-600",children:"Loading clients..."})}):0===u.length?(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"No clients found"}),(0,t.jsx)("button",{onClick:w,className:"bg-[var(--brand-aruba)] text-white px-6 py-2 rounded-lg hover:bg-[var(--brand-aruba-dark)]",children:"Create First Client"})]}):(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:u.map(e=>(0,t.jsx)("div",{className:"bg-white rounded-lg shadow hover:shadow-lg transition-shadow",children:(0,t.jsxs)("div",{className:"p-6",children:[e.logo_url&&(0,t.jsx)("img",{src:e.logo_url,alt:e.name,className:"w-16 h-16 object-cover rounded-lg mb-4"}),(0,t.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,t.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:e.name}),e.featured&&(0,t.jsx)("span",{className:"bg-[var(--brand-sun)] text-white text-xs px-2 py-1 rounded",children:"Featured"})]}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-4 line-clamp-2",children:e.description||"No description"}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:`text-xs px-2 py-1 rounded ${"active"===e.status?"bg-green-100 text-green-800":"pending"===e.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:e.status}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>{x(e),f(!0),b(!0)},className:"text-[var(--brand-aruba)] hover:text-[var(--brand-aruba-dark)]",children:"Edit"}),(0,t.jsx)("button",{onClick:()=>$(e.id),className:"text-red-600 hover:text-red-800",children:"Delete"})]})]})]})},e.id))})]}),y&&(0,t.jsx)(o,{client:h,onClose:()=>{b(!1),f(!1),x(null)},onSave:S})]}):null}function o({client:e,onClose:a,onSave:s}){let[n,l]=(0,r.useState)({name:e?.name||"",description:e?.description||"",logo_url:e?.logo_url||"",category:e?.category||"",status:e?.status||"active",featured:e?.featured||!1,display_order:e?.display_order||0}),[o,c]=(0,r.useState)(!1),d=async t=>{t.preventDefault(),c(!0);try{let t=e?await i.clientProfileApi.updateClient(e.id,n):await i.clientProfileApi.createClient(n);t.success?(s(),a()):alert(t.error||"Failed to save client")}catch(e){console.error("Failed to save client:",e),alert("Failed to save client")}finally{c(!1)}};return(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:e?"Edit Client":"Create Client"}),(0,t.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600",children:"Ã—"})]}),(0,t.jsxs)("form",{onSubmit:d,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Name *"}),(0,t.jsx)("input",{type:"text",required:!0,value:n.name,onChange:e=>l({...n,name:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[var(--brand-aruba)]"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,t.jsx)("textarea",{value:n.description,onChange:e=>l({...n,description:e.target.value}),rows:4,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[var(--brand-aruba)]"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Logo URL"}),(0,t.jsx)("input",{type:"url",value:n.logo_url,onChange:e=>l({...n,logo_url:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[var(--brand-aruba)]"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),(0,t.jsx)("input",{type:"text",value:n.category,onChange:e=>l({...n,category:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[var(--brand-aruba)]"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Display Order"}),(0,t.jsx)("input",{type:"number",value:n.display_order,onChange:e=>l({...n,display_order:parseInt(e.target.value)||0}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[var(--brand-aruba)]"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,t.jsxs)("select",{value:n.status,onChange:e=>l({...n,status:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[var(--brand-aruba)]",children:[(0,t.jsx)("option",{value:"active",children:"Active"}),(0,t.jsx)("option",{value:"inactive",children:"Inactive"}),(0,t.jsx)("option",{value:"pending",children:"Pending"})]})]}),(0,t.jsx)("div",{className:"flex items-center pt-8",children:(0,t.jsxs)("label",{className:"flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",checked:n.featured,onChange:e=>l({...n,featured:e.target.checked}),className:"mr-2"}),(0,t.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Featured"})]})})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-4 pt-4",children:[(0,t.jsx)("button",{type:"button",onClick:a,className:"px-6 py-2 text-gray-700 hover:text-gray-900",children:"Cancel"}),(0,t.jsx)("button",{type:"submit",disabled:o,className:"bg-[var(--brand-aruba)] text-white px-6 py-2 rounded-lg hover:bg-[var(--brand-aruba-dark)] disabled:opacity-50",children:o?"Saving...":"Save"})]})]})]})})})}e.s(["default",()=>l])}]);